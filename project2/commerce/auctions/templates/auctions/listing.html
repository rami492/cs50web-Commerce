{% extends "auctions/layout.html" %}

{%load crispy_forms_tags %} 

{% block body %}
    
    
<div class="container pt-5">
    <div>            
    {% if message %}
        <div class="alert alert-danger text-center">
        {{ message }}
        </div>
    {% elif message1 %}
        <div class="alert alert-success text-center">
            {{ message1 }}
            </div>
    </div>
    {% endif %}

    {% if listing.is_active == False %}
        <div class="float-right">
            <button type="button" class="btn btn-danger"><b>Auction CLOSED</b></button>
        </div>
    {% elif close_btn == True %}
        <div class="float-right">
            <form action="{% url 'listing_page' listing.id %}" method="post">
                {% csrf_token %}
                <button name="close" type="submit" class="btn btn-primary"><b>CLOSE Auction</b></button>
            </form>
        </div>
    {% endif %}
    
    {% if user.is_authenticated %}
        <div class="float-left">
            <form action="{% url 'listing_page' listing.id %}" method="post">
                {% csrf_token %}
                <button name="watchlist-btn" type="submit" class="btn btn-sm m-1 p-0 btn-secondary"><b>WISHLIST</b></button>
            </form>
        </div>
    {% endif %}

    <div class="text-center">
        <img src="{{ listing.image.image.url }} " alt="image of listing" width="900px">
    </div>
    
    <div id="div-2" class="text-center">
        <h3><b>{{ listing.name }}</b></h3>
        <small><p>listing id: {{ listing.id }}</p></small>
        <p><em>category</em>: <strong>{{ listing.category }}</strong></p>
        <div><p style="color:rgb(161, 10, 42); font-size: x-large;"><strong><span style="color:rgb(0, 0, 145);">Starting Bid:</span> $ {{ listing.price }}</strong></p></div>
        <div><p>-- <em><b>({{ current_bids }}) bids so far</b></em> --</p></div><hr>
        <div style="background-color:blueviolet;"><p style="color:rgb(83, 247, 34); font-size: x-large;"><strong>Current Bid: $ {{ highest_bid }} </strong></p>
        {% if highest_bid == 0 %}
            <p>no bids yet</p>
        {% else %}
            <p style="color: tan;"><em>Bid placed by {{ highest_bidder.first_name }} {{ highest_bidder.last_name }}</em></p>
        {% endif %}
        </div>
    </div>

    <div>
        {% if user.is_authenticated %}
            {% if listing.is_active == False %}
                <div style=" background: -moz-linear-gradient(top, #058f0c 0%, #20e120 50%, #12de1c 51%, #46e24e 100%);" class="text-center p-4"><h1><b>{{ highest_bidder.first_name }} {{ highest_bidder.last_name }} Won the Auction</b></h1></div><br><hr>
            {% else %}
                <div class="pt-5">
                    <form action="{% url 'listing_page' listing.id %}" method="post">
                        <div>
                            {% csrf_token %}
                            {{ bid|crispy }}
                        </div>
                        <div class="form-group">
                            <input class="btn btn-sm btn-success" type="submit" value="place bid" name="bid-btn">
                        </div>
                    </form>
                </div><br><hr>
            {% endif %}
        {% endif %}
    </div>
    <br>

    <div>
        <div>
            <h6><u><em><b>Description</b></em></u></h6>
        </div>

        <div>
            <p style="margin-left: 1%;">{{ listing.description }}</p>
        </div>
        <br>

        <div>
            <h6><u><em><b>Features</b></em></u></h6>
        </div>

        <div>
            <ol>
                {% if listing.feature1 == None %}
                    <p></p>
                {% else %}
                    <div class="mt-3"><li>{{ listing.feature1 }}</li></div>
                {% endif %}
                {% if listing.feature2 == None %}
                    <p></p>
                {% else %}
                    <div class="mt-3"><li>{{ listing.feature2 }}</li></div>
                {% endif %}
                {% if listing.feature3 == None %}
                    <p></p>
                {% else %}
                    <div class="mt-3"><li>{{ listing.feature3 }}</li></div>
                {% endif %}
                {% if listing.feature4 == None %}
                    <p></p>
                {% else %}
                    <div class="mt-3"><li>{{ listing.feature4 }}</li></div>
                {% endif %}
                {% if listing.feature5 == None %}
                    <p></p>
                {% else %}
                    <div class="mt-3"><li>{{ listing.feature5 }}</li></div>
                {% endif %}
            </ol>
        </div>
        <br>

        <p style="font-size: smaller; color:sienna;"><strong><em>listed on: {{ listing.timestamp }} by {{listing.user.first_name}} {{listing.user.last_name}}</em></strong></p>

    </div>
    <br><hr><br>


    {% if user.is_authenticated %}
    <div class="pt-5">
        <form action="{% url 'listing_page' listing.id  %}" method="post">
            <div>
                {% csrf_token %}
                {{ comment|crispy }}
            </div>
            <div class="form-group">
                <input class="btn btn-sm btn-success" type="submit" value="Comment" name="comment-btn">
            </div>
        </form>
    </div>
    <br><br>
    
    <div>
        <h6 style="font-size: small;"><em><strong>Latest comments</strong></em></h6>
        <table class="table table-hover">
            <tbody>
                {% for comment in comments %}
                    <tr class="info">
                        <td style="width: 10%;">{{ comment.user.first_name }} {{ comment.user.last_name }} <em><small style="color:grey;">{{ comment.timestamp }}</small></em></td>
                        <td style="width: 60%;"><em><small>{{ comment.content }}</small></em></td>
                {% empty %}
                    <small><em>No Comments.</em></small>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div>
        Already have an account? <a href="{% url 'login' %}">Log In here.</a>
        Don't have an account? <a href="{% url 'register' %}">Register here.</a>
    </div>
    {% endif %}
</div>
<br><br>
        

{% endblock %}